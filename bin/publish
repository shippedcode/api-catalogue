#!/usr/bin/env ruby

require "tmpdir"

publish_dir = Dir.mktmpdir("publish-api-catalogue")
repo_url = `git config --get remote.origin.url`.chomp
rev = `git rev-parse --short HEAD`.chomp

system("git clone --single-branch --branch gh-pages #{repo_url} #{publish_dir}")
system("rsync -a --delete build/api-catalogue/ #{publish_dir}")
system("git -C #{publish_dir} add --all")
system("git -C #{publish_dir} commit -m 'Publish #{rev}'")
system("git -C #{publish_dir} push")
